
Last updated `r as.character(Sys.time())` using `r R.version$version.string`.

## Introduction

This document was generated by sourcing the file `run_analysis.R` in `R` or `RStudio` - the file run_analysis.Rmd must 
be in the same directory.

In general, the script will
 
* [Download the data] from
  [UCI Machine Learning Repository](http://archive.ics.uci.edu/ml/index.html)
* [Merge the training and test sets]  to create one data set
* [Replace numeric `activity` values with a verbal description]  
* [Extract mean and standard deviation features] for each measurement (or feature)
* [Rename the feature columns with descriptive names]
* [Create a second, independent tidy dataset] with an average of each variable
  for each each activity and each subject.  
* [Export `tidy` dataframe to a csv file]

##Download the data

Check to see if `data` directory exists and if, not create it. 

```{r }
	if (!file.exists("data")) {
		message("Creating data directory")
		dir.create("data")
    }
```

Check to see if the data files are present and if not, fetch them.

```{r }
	if (!file.exists("data/UCI HAR Dataset")) {
		fileURL <- 
			"https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
		zipfile="data/UCI_HAR_data.zip"
		message("Downloading data")
		download.file(fileURL, destfile=zipfile, method="curl")
		unzip(zipfile, exdir="data")
    }
```

##Merge the training and test sets

Load data files into distinct dataframes.
 
```{r }
	training.x <- read.table("data/UCI HAR Dataset/train/X_train.txt")
	training.activity <- read.table("data/UCI HAR Dataset/train/y_train.txt")
	training.subject <- read.table("data/UCI HAR Dataset/train/subject_train.txt")
	test.x <- read.table("data/UCI HAR Dataset/test/X_test.txt")
	test.activity <- read.table("data/UCI HAR Dataset/test/y_test.txt")
	test.subject <- read.table("data/UCI HAR Dataset/test/subject_test.txt")
```
Combine the dataframes into one composite dataframe.

```{r }
	merged.x <- rbind(training.x, test.x)
	merged.activity <- rbind(training.activity, test.activity)
	merged.subject <- rbind(training.subject, test.subject)
	colnames(merged.activity) <- "activity"
	colnames(merged.subject) <- "subject"
	df.merged <- data.frame( merged.subject, merged.activity, merged.x)
```
#Replace numeric `activity` values with a verbal description

```{r }
	df.merged$activity[df.merged$activity == 1] = "WALKING"
	df.merged$activity[df.merged$activity == 2] = "WALKING_UPSTAIRS"
	df.merged$activity[df.merged$activity == 3] = "WALKING_DOWNSTAIRS"
	df.merged$activity[df.merged$activity == 4] = "SITTING"
	df.merged$activity[df.merged$activity == 5] = "STANDING"
	df.merged$activity[df.merged$activity == 6] = "LAYING"
```
#Extract mean and standard deviation features

`grepl` returns a boolean vector, the `fixed` parameter ensures the various characters vectors are matched 
without confusion arising from paranthesis.


```{r }
	features <- read.table("data/UCI HAR Dataset/features.txt")
	mean.cols <-  grepl("mean()", features[,2], fixed=T)
	std.cols <-  grepl("std()", features[,2], fixed=T) 
	df.mean.std <- df.merged[, c(T,T,(mean.cols | std.cols))]
```

#Rename the feature columns with descriptive names
```{r }
	colnames(df.mean.std) <- 
		c("subject","activity", as.vector(features[(mean.cols | std.cols), 2]))
```

#Create a second, independent tidy dataset

Load library `plyr`, and create a dataframe with the function `ddply` which groups data by `subject` and
`activity` and returns the means of the feature variables for each group.
`tidy` is a dataframe of 180 rows (30 subjects x 6 activities) with 66 variables (33 mean() and 33 std()).

```{r }
	library(plyr)
	tidy <- ddply(df.mean.std, 
				.(subject, activity), 
				function(df) colMeans(df[,3:ncol(df.mean.std)])
				)
```

#Export `tidy` dataframe to a csv file

Finally we write the `tidy` dataframe out to a csv file called 
`UCI_HAR_tidy.csv`.

```{r}
	write.csv(tidy, "UCI_HAR_tidy.csv", row.names=FALSE)
```


